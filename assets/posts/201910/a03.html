<p>最近有一个项目，领导要求：要让一个<strong>视频</strong>在<strong>一屏显示</strong>的情况下<strong>不能改变宽高比</strong> and <strong>适配各种分辨率</strong> and <strong>兼容到IE 7</strong>。嘶~，有点棘手，对于要兼容到IE 7的项目，写CSS简直头疼。</p>
<p>不过不是我做（欸嘿），别人也没做出来，我也没站出来（面子最重要），于是领导不得不放低要求，当然这都是后话了。</p>
<p> <img src="/assets/posts/201910/zhazha.jpg" alt=""></p>
<p>后来想，如果我来做的话，我会怎么做？对于领导的要求，我脑子里第一个闪过的就是<code>background-size: cover</code>这个玩意儿，但是第一，这个是CSS 3的属性，IE 8就歇菜了，更别说IE 7了，第二，这个属性只对图片有用……</p>
<p>那能不能用js来模拟呢？</p>
<p>说干就干，当下就开始研究<code>cover</code>属性是怎么工作的，最后结论是：</p>
<p><code>cover</code>在正常情况下，只是单纯的将图片宽度放到与容器一样宽，在缩放过程中，<strong>当图片高度小于容器高度时</strong>，<strong>会根据原始图片的宽高比(ratio)来放大图片宽度</strong>，使原始图片始终撑满容器。</p>
<p>听起来有点绕，直接上代码：</p>
<pre><code class="javascript hljs">;(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">w</span>) </span>{
    <span class="hljs-keyword">var</span> kkkover = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        _ = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">this</span>.init = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
            w.onresize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                _.resized(obj);
            }
            obj.img.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                obj.ratio = obj.img.clientHeight / obj.img.clientWidth;
                _.calcStyle(obj);
            }
            obj.ratio = obj.img.clientHeight / obj.img.clientWidth;
            _.calcStyle(obj);
        }
        <span class="hljs-keyword">this</span>.calcStyle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
            obj.wrapCell.style.position = <span class="hljs-string">'relative'</span>;
            obj.img.style.position = <span class="hljs-string">'absolute'</span>;
            obj.img.style.top = <span class="hljs-string">'50%'</span>;
            obj.img.style.zIndex = <span class="hljs-string">'0'</span>;
            obj.img.style.left = <span class="hljs-string">'50%'</span>;
            obj.img.style.width = <span class="hljs-string">'100%'</span>;
            obj.img.style.marginLeft = -(obj.img.clientWidth / <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>;
            obj.img.style.marginTop = -(obj.img.clientHeight / <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>;
            <span class="hljs-keyword">if</span>(obj.img.clientHeight &lt;= obj.wrapCell.clientHeight){
                obj.img.style.maxWidth = <span class="hljs-string">'none'</span>;
                obj.img.style.height = obj.wrapCell.clientHeight;
                obj.img.style.width = obj.wrapCell.clientHeight / obj.ratio + <span class="hljs-string">'px'</span>;
                obj.img.style.marginTop = -(obj.img.clientHeight / <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>
                obj.img.style.marginLeft = -(obj.img.clientWidth / <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>;
            }
            <span class="hljs-keyword">if</span>(obj.wrapCell.clientWidth &gt; obj.img.clientWidth){
                obj.img.style.width = <span class="hljs-string">'100%'</span>;
                obj.img.style.height = <span class="hljs-string">'auto'</span>;
                obj.img.style.marginLeft = -(obj.img.clientWidth / <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>;
                obj.img.style.marginTop = -(obj.img.clientHeight / <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>;
            }
        }
        <span class="hljs-keyword">this</span>.resized = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
            _.calcStyle(obj);
        }
    }
    <span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> kkkover();
    <span class="hljs-keyword">var</span> wp = w.prototype || w.__proto__ || w;
    wp.kkkover = app.init;
}(<span class="hljs-built_in">window</span>));</code></pre>
<p>使用的话大概就是这样：</p>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"test"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"path/to/img"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"test_img"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
<pre><code class="javascript hljs">kkkover({
    <span class="hljs-attr">wrapCell</span>: <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'test'</span>), <span class="hljs-comment">// 传入容器</span>
    img: <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'test_img'</span>) <span class="hljs-comment">// 传入容器中的图片</span>
});</code></pre>
<p>可以在这里看一下<a href="https://jw1.dev/assets/posts/201910/a03_demo/">演示</a>。代码已经测试，可以兼容到IE 7。</p>
<p>对于视频也是一样的用法，<code>img</code>传视频元素就可以了。</p>
<p>✌</p>
