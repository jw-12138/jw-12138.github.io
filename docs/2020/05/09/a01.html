<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LNMPå¦‚ä½•é…ç½®Gitlabçš„åå‘ä»£ç†å’ŒHTTPS - ä¸€ä¸ªçƒçš„åšå®¢</title>
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
<link rel="preconnect" href="https://fonts.gstatic.com" />
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Lexend&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="/assets/css/index.min.css" />
<meta name="keywords" content="ä¸€ä¸ªçƒ,å‰ç«¯,ç½‘é¡µ,web,æŠ€æœ¯,css3,html5,frontend,front-end,ableton,live,music,production,ç¼–æ›²,éŸ³ä¹åˆ¶ä½œ,åˆ¶ä½œäºº,æ‘„å½±,GitlabNginxHTTPSLNMP" id="keywords" />
<meta name="description" content="Front-end Developer / Music Producer" />
    
  </head>
  <body>
    <div id="app">
      <div class="app-wrap">
        <header>
  <div class="logo">
    <a href="/" title="Click here to navigate homepage" id="header">
      <div class="img">
        <img src="/assets/img/logo-black.png" alt="logo" class="dark" />
        <img src="/assets/img/logo.png" alt="logo" class="light" />
      </div>
    </a>
  </div>
  <div class="slogan" ref="slogan">
    Front-end Developer / Music Producer
  </div>
  <div class="page-small-menu" v-if="page_small">
    <ul>
      
      <li>
        <a href="/about/">About Me</a>
      </li>
      
      <li>
        <a href="/atom.xml" target="_blank">RSS</a>
      </li>
    </ul>
  </div>
</header>
        <div class="page-wrap">
          <section class="pages" style="padding-top: 20px">
            <div class="page">
              <div class="wrap">
                <h2 class="page-header">LNMPå¦‚ä½•é…ç½®Gitlabçš„åå‘ä»£ç†å’ŒHTTPS</h2>
                
                <span class="page-deprecated"> This article might contains outdated or misleading contents due to it is tagged as "Deprecated" by its author. </span>
                 
                <div class="page-date">
                  <span>ğŸ‘¨â€ğŸ’» 2020-05-09</span>
                  
                </div>
                
                <div class="page-content"><p>ä½¿ç”¨Gitlab CEç‰ˆå·²ç»æœ‰ä¸€å¹´å¤šäº†ï¼ŒæœŸé—´ä¸€ç›´åœ¨ä½¿ç”¨<code>http://ip:port</code>çš„æ–¹å¼æ¥è¿›è¡Œè®¿é—®ã€‚å¾ˆæ˜æ˜¾ï¼Œç¼ºç‚¹æœ‰äºŒï¼š</p>
<ul>
<li>æ²¡æœ‰ä½¿ç”¨httpsï¼Œå®‰å…¨æ€§å ªå¿§ã€‚</li>
<li>æ²¡æœ‰ä½¿ç”¨åŸŸåï¼Œçœ‹èµ·æ¥å¹¶ä¸ä¸“ä¸š...ï¼ˆ</li>
</ul>
<p>åˆæœŸä½¿ç”¨çš„æ—¶å€™å¹¶ä¸æ˜¯æ²¡æœ‰è€ƒè™‘è¿‡è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç½‘ä¸Šçš„æ•™ç¨‹å¤§å¤šéƒ½æ˜¯ç›´æ¥nginxé…ç½®åå‘ä»£ç†ï¼Œä¸”æ²¡æœ‰httpsï¼Œï¼ˆä¸”å¤§éƒ¨åˆ†éƒ½é•¿å¾—ä¸€æ ·ï¼Œ(â•¬â–”çš¿â–”)å‡¸ï¼‰ï¼Œæ‰€ä»¥æŒ‰ç…§ä»–ä»¬çš„æ•™ç¨‹æ¥ï¼Œæ²¡æœ‰ä¸€æ¬¡æ˜¯æˆåŠŸçš„... åæ¥ä¹Ÿå°±æ”¾å¼ƒäº†é…ç½®åŸŸåå’Œhttps...</p>
<p>ç›´åˆ°ä»Šå¤©ï¼Œå†³å®šå†é—¯ä¸€æ¬¡è™å±±ï¼Œç»ˆäºæŒæ¡äº†è¦ç‚¹...å•Š~</p>
<h3 id="gitlab"># ä¿®æ”¹Gitlabé…ç½®æ–‡ä»¶</h3>
<p>å‡è®¾ä½ å·²ç»æ‹¥æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä¸€ä¸ªåŸŸåï¼Œä¸”å·²ç»è§£æåˆ°ä½ ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šï¼Œä½ çš„æœåŠ¡å™¨å·²ç»è£…å¥½gitlabï¼Œè€Œä¸”å¯ä»¥æ­£å¸¸ä½¿ç”¨ipåœ°å€è¿›è¡Œè®¿é—®ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ä½¿ç”¨vimç¼–è¾‘gitlabé…ç½®æ–‡ä»¶</span>
vim /etc/gitlab/gitlab.rb
</code></pre></div></div>
<p>å¦‚æœä½ è¿˜ä¸ä¼šä½¿ç”¨vimå¯ä»¥çœ‹çœ‹æˆ‘å†™çš„å¦ä¸€ç¯‡åšå®¢ã€Š<a href="https://jw1.dev/2019/11/11/a01.html">æ¥è‡ªä¸€ä¸ªä¸å–œæ¬¢ç”¨Vimçš„å¼±é¸¡ç¨‹åºå‘˜çš„Vimæ•™ç¨‹</a>ã€‹ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ä¿®æ”¹gitlabå¤–éƒ¨è®¿é—®é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯ä½ æƒ³é…ç½®çš„åŸŸå</span>
<span class="c"># è¿™é‡Œå‡è®¾ä½ çš„å¤–éƒ¨åŸŸåä¸º</span>
external_url <span class="s1">'https://git.aaa.com'</span>
</code></pre></div></div>
<p>è¿™é‡Œæ˜¯ä¿®æ”¹gitlabç›‘å¬çš„å¤–éƒ¨nginxç«¯å£ï¼Œç«¯å£å·éšæ„ï¼Œåªè¦åˆ«å ç”¨ä¸€äº›é‡è¦ç«¯å£å°±å¯ä»¥ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ä½¿ç”¨`/`å‘½ä»¤æœç´¢ `nginx['listen_port']`</span>
nginx[<span class="s1">'listen_port'</span><span class="o">]</span> <span class="o">=</span> 8118
</code></pre></div></div>
<p>ç„¶å<code>:wq</code>ä¿å­˜å¹¶é€€å‡º</p>
<p>é‡æ–°é…ç½®gitlabï¼Œç„¶åé‡å¯gitlabæœåŠ¡</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab-ctl reconfigure
gitlab-ctl restart
</code></pre></div></div>
<h3 id="lnmphttps"># ä½¿ç”¨lnmpé…ç½®https</h3>
<p>æˆ‘è¿™é‡Œlnmpç‰ˆæœ¬ä¸º1.5ã€‚</p>
<p>è‡³äºæ€ä¹ˆç”¨lnmpé…ç½®httpsï¼Œç½‘ä¸Šæ•™ç¨‹å·²ç»æ»¡å¤©é£äº†ï¼Œæˆ‘å°±ä¸å¤šåºŸè¯äº†...</p>
<p>ä¸è¿‡è¿˜æ˜¯æä¸¤å¥ï¼š</p>
<ul>
<li>æœ€å¥½çš„æ•™ç¨‹ï¼šå®˜ç½‘ --&gt; https://lnmp.org/install.html</li>
<li>å¦‚æœsslé…ç½®çš„æ—¶å€™éªŒè¯ä¸æˆåŠŸï¼Œé¦–å…ˆç¡®è®¤ä¸€ä¸‹ä½ çš„æœåŠ¡å™¨80ç«¯å£æ˜¯å¦å¯ä»¥è®¿é—®</li>
</ul>
<h3 id="lnmpnginx-vhost"># ç¼–è¾‘lnmpä¸­çš„Nginx Vhosté…ç½®æ–‡ä»¶ä»¥è¿›è¡Œåå‘ä»£ç†</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># è¿›å…¥åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œä½ åº”è¯¥å°±èƒ½çœ‹åˆ°æ‰€æœ‰çš„lnmpåŸŸåé…ç½®æ–‡ä»¶</span>
<span class="nb">cd</span> /usr/local/nginx/conf/vhost
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ä¿®æ”¹ä½ çš„gitåŸŸåé…ç½®</span>
vim git.aaa.com.conf
</code></pre></div></div>
<p>ä½ çœ‹åˆ°çš„æ ¼å¼åº”è¯¥å¦‚ä¸‹ï¼š</p>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span>
    <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
        <span class="c1"># listen [::]:80;</span>
        <span class="c1"># ...</span>
    
    	<span class="c1"># å¯ä»¥åœ¨ç›‘å¬80ç«¯å£è¿™é‡Œæ·»åŠ ä¸€å¥ï¼Œè¿™æ ·httpå°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°https</span>
    	<span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
    
        <span class="kn">location</span> <span class="n">/</span>
        <span class="p">{</span>
            <span class="c1"># ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ æœ¬åœ°gitæœåŠ¡ä¿¡æ¯</span>
<span class="k">upstream</span> <span class="s">git</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="nf">localhost</span><span class="p">:</span><span class="mi">8118</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span>
    <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
<span class="kn">...</span> <span class="s">...</span> <span class="s">...</span> <span class="s">...</span> 
</code></pre></div></div>
<p>å¥½äº†ï¼Œ80ç«¯å£çš„éƒ¨åˆ†ä¸ç”¨ç®¡ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹443éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯httpséƒ¨åˆ†</p>
<p>serveré‡Œä¸Šé¢éƒ¨åˆ†ä¸ç”¨åŠ¨ï¼Œä¸‹é¢çš„locationå…ˆå…¨éƒ¨åˆ é™¤</p>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span>
    <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span> <span class="s">http2</span><span class="p">;</span>
        <span class="kn">server_name</span> <span class="s">git.jacky97.top</span> <span class="p">;</span>
        <span class="kn">ssl_certificate</span> <span class="p">;</span>
        <span class="kn">ssl_certificate_key</span> <span class="p">;</span>
        <span class="kn">ssl_session_timeout</span> <span class="mi">5m</span><span class="p">;</span>
        <span class="kn">ssl_protocols</span> <span class="p">;</span>
        <span class="kn">ssl_prefer_server_ciphers</span> <span class="p">;</span>
        <span class="kn">ssl_ciphers</span> <span class="p">;</span>
        <span class="kn">ssl_session_cache</span> <span class="p">;</span>
        <span class="kn">ssl_dhparam</span> <span class="p">;</span>
        <span class="kn">include</span> <span class="nc">rewrite/other</span><span class="s">.conf</span><span class="p">;</span>
        <span class="kn">include</span> <span class="s">enable-php.conf</span><span class="p">;</span>
    
    	<span class="c1"># ====== é‡ç‚¹ ======</span>
    	<span class="c1"># è¿™é‡Œå°±ç…§æŠ„ç½‘ä¸Šçš„æ•™ç¨‹äº†</span>
    	<span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
            <span class="kn">client_max_body_size</span> <span class="mi">512m</span><span class="p">;</span>
            <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
            <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
            <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
            <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        
            <span class="c1"># ä¸ä¸€æ ·çš„æ˜¯è¿™é‡Œè®¾ç½®ä¸€ä¸‹ç¼“å­˜ï¼Œä¸ç„¶ä¼šå‡ºç°400é”™è¯¯</span>
        	<span class="kn">proxy_buffer_size</span> <span class="mi">64k</span><span class="p">;</span>
            <span class="kn">proxy_buffers</span> <span class="mi">32</span> <span class="mi">32k</span><span class="p">;</span>
            <span class="kn">proxy_busy_buffers_size</span> <span class="mi">128k</span><span class="p">;</span>
			
        	<span class="c1"># è¿™é‡Œè®¾ç½®æˆä½ æœåŠ¡å™¨gitlabçš„è®¿é—®è·¯å¾„å’Œåˆšåˆšè®¾ç½®çš„ç«¯å£</span>
            <span class="kn">proxy_pass</span> <span class="s">http://localhost:8118</span><span class="p">;</span>
            <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<h3 id="http-502"># å¦‚æœå‡ºç°http 502é”™è¯¯æ€ä¹ˆåŠ</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># è¿›å…¥/var/logæ–‡ä»¶å¤¹</span>
<span class="nb">cd</span> /var/log
<span class="c"># å°†gitlabæ–‡ä»¶å¤¹çš„æƒé™è®¾ç½®ä¸º775</span>
<span class="nb">chmod</span> <span class="nt">-R</span> 775 gitlab
</code></pre></div></div>
<h3 id="web-ide"># Web IDEæ‰“ä¸å¼€æ€ä¹ˆåŠ</h3>
<p>ä¸€èˆ¬æ˜¯å‡ºç°<code>Mixed Context</code>é”™è¯¯ â€”â€” httpsç«™å¼•ç”¨äº†httpèµ„æºã€‚è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p>
<p>ç¡®è®¤ä¸€ä¸‹ä½ çš„gitlabé…ç½®æ–‡ä»¶ä¸­å¤–éƒ¨é“¾æ¥æ˜¯<code>HTTPS</code>å¼€å¤´ï¼Œä¸”gitlabè‡ªå¸¦çš„ç›‘å¬httpsæ˜¯å…³é—­çŠ¶æ€ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>external_url <span class="s1">'https://git.aaa.com'</span>

nginx[<span class="s1">'listen_https'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">false</span>
</code></pre></div></div>
<p>å®Œæˆåï¼Œé‡æ–°é…ç½®ã€é‡å¯gitlabå’Œlnmpï¼Œå†è®¾ç½®ä¸€élogæ–‡ä»¶çš„æƒé™</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab-ctl reconfigure
gitlab-ctl restart
lnmp restart
<span class="nb">chmod</span> <span class="nt">-R</span> 775 /var/log/gitlab
</code></pre></div></div>
<p>ç°åœ¨ä½ å°±å¯ä»¥ç”¨<code>https://git.aaa.com</code>æ¥è®¿é—®ä½ çš„gitlabäº†ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ä¸‹é¢çš„è¯„è®ºåŒºåŸŸå‘Šè¯‰æˆ‘ï¼</p>
</div>
                <div class="page-original">
                  <a class="license" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width: 0" src="/assets/img/cc.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
                </div>
              </div>
            </div>
          </section>
          <section class="aside" v-if="!page_small" aria-label="aside">
            <ul>
              
              <li>
                <a href="/about/" class="dontread" title="About Me">ğŸ‘¦ About Me</a>
              </li>
              
              <li>
                <a href="/atom.xml" title="RSS feeds" class="dontread" target="_blank">ğŸš© RSS</a>
              </li>
            </ul>
          </section>
        </div>
        <footer>Â© <span class="copy_right_year">2018 - 2021</span><a href="/" class="footer-link">ä¸€ä¸ªçƒçš„åšå®¢</a>code with â¤</footer>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js"></script>
    
    <script src="/assets/js/post.js"></script>
  </body>
</html>
