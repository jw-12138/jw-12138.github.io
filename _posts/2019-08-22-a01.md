---
title: å¼€å‘ä¸€ä¸ªwebéŸ³ä¹æ’­æ”¾å™¨åˆ°åº•æœ‰å¤šéš¾ï¼Ÿ
tags: JavaScript, éŸ³ä¹æ’­æ”¾å™¨, Web App
modified: 2020-10-17
---

å‰æ®µæ—¶é—´æ¯”è¾ƒé—²ï¼Œé¡ºä¾¿å°±å¼€å‘äº†è‡ªå·±çš„éŸ³ä¹ä¸»é¡µğŸ‘‰[https://music.jw1.dev](https://music.jw1.dev)ï¼Œå¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°ä¸å°‘é—®é¢˜ï¼Œä¸€åº¦ä»¥ä¸ºè§£å†³ä¸äº†ï¼Œä½†æ˜¯æœ€åçœ‹æ¥ï¼Œå…¶å®å®ç°éƒ½éå¸¸ç®€å•ã€‚

é¦–å…ˆçœ‹çœ‹htmlå§

```html
<audio src="path/to/your/audio/file"></audio>

<!-- æˆ–è€… -->
<audio>
    <source src="path/to/your/audio/file" type="audio/mpeg">
</audio>
```

è¿™æ—¶å€™æ‰“å¼€é¡µé¢ä½ ä¼šå‘ç°...ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚

```html
<audio src="path/to/your/audio/file" controls></audio>
```

åŠ ä¸Š`controls`è¿™ä¸ªå±æ€§ï¼Œæµè§ˆå™¨æ‰ä¼šæ˜¾ç¤ºåŸç”Ÿçš„éŸ³é¢‘ç»„ä»¶ã€‚è‡³äºæµè§ˆå™¨å…¼å®¹æ€§æˆ‘å°±ä¸è®²äº†ï¼Œè¿˜æ˜¯è€æ ·å­æ‰”ä¸ªMDNé“¾æ¥åœ¨è¿™é‡ŒğŸ˜ï¼š[https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio#Browser_compatibility](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio#Browser_compatibility)

æ‰€ä»¥ï¼Œæå®šäº†ï¼Ÿ

ä¸ï¼åƒæˆ‘è¿™ç§æœ‰å¼ºè¿«ç—‡çš„äººï¼Œæ€ä¹ˆå¯èƒ½è®©æ¯ä¸ªæµè§ˆå™¨çš„æ˜¾ç¤ºéƒ½ä¸ä¸€è‡´ï¼

è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯ï¼Œéšè—`audio`çš„åŸç”Ÿæ§åˆ¶ç»„ä»¶ï¼š

```html
<audio src="path/to/your/audio/file"></audio>
<!-- å»æ‰ controls -->
```

(ğŸ‘†ä¸‰éäº†ğŸ¤£

ç„¶åç”¨CSSå°†`audio` ç§»å‡ºæ–‡æ¡£æµï¼š

```css
audio{position:fixed;top:0;left:-12138px;}
```

ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ

â€”â€” ä¸ºäº†é¿å…ä¸€äº›éä¸»æµçš„æµè§ˆå™¨ä¼šè®©`audio`åœ¨æ²¡æœ‰`controls`å±æ€§çš„æƒ…å†µä¸‹å‡ºç°åœ¨ä¸åº”è¯¥å‡ºç°çš„åœ°æ–¹ã€‚(å¥½ç´¯

æ¥ä¸‹æ¥çœ‹JSçš„éƒ¨åˆ†

``` javascript
let audio = document.querySelector('audio')

// æˆ–è€…ç”¨jQuery
let audio = $('audio')

console.log(audio)
```

åŸç”ŸJavaScriptåœ¨logä¸‹åªèƒ½çœ‹åˆ°æ ‡ç­¾ï¼Œè€ŒjQueryåˆ™ä¼šæŠŠæ‰€æœ‰å’Œè¿™ä¸ªå…ƒç´ æœ‰å…³çš„ä¸œè¥¿éƒ½åˆ—å‡ºæ¥ï¼Œä¸è®ºæ˜¯æœ‰ç”¨çš„è¿˜æ˜¯æ²¡æœ‰ç”¨çš„ã€‚ä½†æ˜¯çŸ¥é“æœ‰é‚£ä¹ˆå¤šå±æ€§/äº‹ä»¶å¯ä»¥ç”¨æ˜¯ä»¶å¥½äº‹ï¼Œåœ¨è¿™é‡Œè¯´å‡ æ ·æ¯”è¾ƒé‡è¦çš„ã€‚

> æ¥ä¸‹æ¥jsåŒºåŸŸä¸­çš„`audio`éƒ½æ˜¯ä»¥åŸç”Ÿjsè·å–çš„å¯¹è±¡ï¼Œå¦‚æœä½ ä½¿ç”¨jQueryï¼Œaudioèµ‹å€¼åº”è¯¥ä¸º
>
> ```javascript
> let audio = $($('audio')[0])
> ```

#### # audio.play()

å¯ä»¥è°ƒç”¨æ­¤æ–¹æ³•æ¥æ’­æ”¾éŸ³é¢‘ã€‚å› ä¸ºå¸‚é¢ä¸Šå¤§å¤šæ•°æµè§ˆå™¨ä¸å…è®¸ç›´æ¥ç”¨jsè§¦å‘éŸ³ä¹æ’­æ”¾ï¼Œå¿…é¡»è¦ç”±ç”¨æˆ·æ¥è§¦å‘è¯¥äº‹ä»¶('click', 'scroll', 'focus', etc.)ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªæ’­æ”¾æŒ‰é’®æ¥è§¦å‘äº‹ä»¶ï¼š

```html
<audio src="path/to/your/audio/file"></audio>

<button class="play">play</button>
```

```javascript
// è·å–play button
let playBtn = document.querySelector('.play');

// ç»™play buttonæ·»åŠ ç‚¹å‡»äº‹ä»¶
playBtn.addEventListener('click',function(){
    
    // play button ç‚¹å‡»åæ’­æ”¾éŸ³é¢‘
    audio.play()
})
```

#### # audio.pause() & audio.paused

è°ƒç”¨`audio.pause()`æ¥æš‚åœéŸ³é¢‘ã€‚

è°ƒç”¨`audio.paused`æ¥è·å–éŸ³é¢‘æš‚åœçŠ¶æ€ï¼Œ`true`ä¸ºæš‚åœçŠ¶æ€ï¼Œ`false`åˆ™ä¸ºæ’­æ”¾çŠ¶æ€ã€‚

æ¯”å¦‚æˆ‘ç°åœ¨éœ€è¦å†ç‚¹å‡»ä¸€æ¬¡play buttonæ¥æš‚åœéŸ³é¢‘ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š

```javascript
playBtn.addEventListener('click',function(){
    
    // ç‚¹å‡»ååˆ¤æ–­éŸ³é¢‘æ˜¯å¦ä¸ºæš‚åœçŠ¶æ€
    if(audio.paused){
        
        // å¦‚æœaudio.pausedä¸ºtrue
        // åˆ™éŸ³é¢‘ä¸ºæš‚åœçŠ¶æ€
        // è¿™æ—¶å€™æˆ‘ä»¬å°±è¦æ’­æ”¾éŸ³é¢‘
        // åŒæ—¶ä¿®æ”¹buttonçš„æ–‡å­—ä¸ºpause
        audio.play()
        playBtn.innerHTML = 'pause'
    }else{
        
        // å¦‚æœaudio.pausedä¸ºfalse
        // åˆ™éŸ³é¢‘ä¸ºæ’­æ”¾çŠ¶æ€
        // è¿™æ—¶å€™æˆ‘ä»¬å°±è¦æš‚åœéŸ³é¢‘
        // åŒæ—¶ä¿®æ”¹buttonçš„æ–‡å­—ä¸ºplay
        audio.pause()
        playBtn.innerHTML = 'play'
    }
})
```

#### # audio.currentTime

è°ƒç”¨æ­¤å±æ€§è·å–éŸ³é¢‘å½“å‰å·²æ’­æ”¾æ—¶é—´ã€‚

ä¿®æ”¹æ­¤å±æ€§å¯ä»¥è¾¾åˆ°åˆ‡æ¢éŸ³é¢‘å½“å‰æ’­æ”¾ä½ç½®çš„åŠŸèƒ½ï¼š

```javascript
// å¿«è¿›åç§’
fastForward = function(){
    audio.currentTime = audio.currentTime + 10
}
fastForward()
```

#### # audio.duration

è°ƒç”¨æ­¤å±æ€§è·å–éŸ³é¢‘çš„é•¿åº¦ï¼Œå•ä½ä¸ºç§’ã€‚

**å·²çŸ¥é—®é¢˜**ï¼š

1. åœ¨`Firefox`ä¸Šä¼šå‡ºç°è¯»ä¸åˆ°durationçš„æƒ…å†µï¼Œå¯èƒ½å’Œä¿®æ”¹`audio.src`æœ‰å…³ï¼Œæˆ‘åœ¨è‡ªå·±é¡¹ç›®ä¸­çš„åšæ³•æ˜¯ä½¿ç”¨äº†`ffmpeg`è¯»å–å‡ºdurationï¼Œç›´æ¥å½“ä½œå˜é‡ä½¿ç”¨ï¼Œæ²¡æœ‰ä½¿ç”¨æµè§ˆå™¨ç»™çš„è¿™ä¸ªå±æ€§ã€‚

#### # audio.ontimeupdate

æ­¤æ–¹æ³•åœ¨éŸ³é¢‘æ’­æ”¾æœŸé—´ä¼šå¾ªç¯è°ƒç”¨ï¼Œç»æµ‹è¯•ï¼Œè°ƒç”¨é—´éš”å¤§çº¦ä¸º200msä¸€æ¬¡ã€‚

æ­¤æ–¹æ³•å¯ä»¥ç”¨åœ¨æ›´æ–°éŸ³é¢‘è¿›åº¦æ¡ä¸Šã€‚æœ‰äº†ä¸Šé¢çš„`audio.currentTime`å’Œ`audio.duration`ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡ºå½“å‰éŸ³é¢‘æ’­æ”¾è¿›åº¦çš„ç™¾åˆ†æ¯”ï¼š

```javascript
// å°†ç™¾åˆ†æ¯”å®šä¸ºå…¨å±€å˜é‡
let audioProgressPercent = 0;
audio.ontimeupdate = function(){
    
    // åœ¨audioæ—¶é—´æ›´æ–°çš„æ—¶å€™è®¡ç®—å½“å‰è¿›åº¦ç™¾åˆ†æ¯”
    audioProgressPercent = audio.currentTime / audio.duration
    console.log(audioProgressPercent)
}
```

è¿™ä¸ªæ—¶å€™å¦‚æœä½ æ‰“å¼€é¡µé¢å¼€å§‹æ’­æ”¾éŸ³é¢‘ï¼Œå°±ä¼šçœ‹åˆ°æ§åˆ¶å°ä¸€ç›´åœ¨æ›´æ–°è¿›åº¦ç™¾åˆ†æ¯”äº†ï¼Œè‡³äºè¿™ä¸ªæ•°å€¼æ€ä¹ˆç”¨ï¼Œä¸ç”¨æˆ‘æ•™å¤§å®¶äº†å§ã€‚ğŸ˜

#### # audio.buffered

è°ƒç”¨æ­¤å±æ€§å¯ä»¥è·å–å½“å‰éŸ³é¢‘çš„ç¼“å†²è¿›åº¦å’ŒåŒºé—´ï¼š

```javascript
// æ¯200msè·å–ä¸€æ¬¡ç¼“å†²åŒºé—´
let bufferedTimeInterval = setInterval(function(){

    // ç¼“å†²å¯ä»¥æœ‰å¤šä¸ªåŒºé—´
    // æ‰€ä»¥æˆ‘ä»¬å°½é‡éƒ½è·å–åˆ°
    let bufferedLength = audio.buffered.length

    // ä»¥bufferedLengthåšå¾ªç¯
    for (let i = 0; i < bufferedLength; i++) {
        let bufferedStart = audio.buffered.start(i)
        let bufferedEnd = audio.buffered.end(i)
        console.log(bufferedStart, bufferedEnd)
    }
},200)
```

æ§åˆ¶å°è¾“å‡ºï¼š

```text
> 0 17.64
  56.45 78.90
```

è¾“å‡ºçš„å«ä¹‰ä¸ºï¼š

è¿™ä¸€æ¬¡è¯»å–`audio.buffered`å¾—åˆ°äº†ä¸¤ä¸ªåŒºé—´ï¼Œæ‰€ä»¥å¾ªç¯äº†ä¸¤æ¬¡ã€‚

ç¬¬ä¸€æ¬¡è·å¾—çš„åŒºé—´æ˜¯`[0,17.64]`ï¼Œä»£è¡¨ç¬¬0ç§’åˆ°ç¬¬17.64ç§’ä¹‹é—´çš„éŸ³é¢‘å·²ç»ç¼“å†²å¥½äº†ï¼Œå¯ä»¥ç›´æ¥æ’­æ”¾ã€‚

ç¬¬äºŒæ¬¡è·å¾—çš„åŒºé—´æ˜¯`[56.45,78.90]`ï¼Œä»£è¡¨è¿™ä¸¤ä¸ªæ•°å­—ä¹‹é—´çš„éŸ³é¢‘å·²ç»ç¼“å†²å¥½äº†ï¼Œå¯ä»¥ç›´æ¥æ’­æ”¾ã€‚

#### # audio.onwaiting & audio.onplay

`audio.onwaiting`ä¼šåœ¨éŸ³é¢‘å¼€å§‹ç¼“å†²çš„æ—¶å€™è¢«æ¿€æ´»ï¼›

`audio.onplay`ä¼šåœ¨éŸ³é¢‘å¼€å§‹æ’­æ”¾çš„æ—¶å€™è¢«æ¿€æ´»ï¼›

è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªloadingçš„åŠ¨ç”»ï¼Œå‘Šè¯‰ç”¨æˆ·éŸ³é¢‘æ­£åœ¨åŠ è½½äº†ï¼š

```javascript
audio.onwaiting = function () {
    console.log('audio is loading')
    // åœ¨è¿™é‡Œæ¿€æ´»loadingåŠ¨ç”»
}
audio.onplay = function () {
    console.log('audio is playing')
    // åœ¨è¿™é‡Œå…³é—­loadingåŠ¨ç”»
}
```

#### # audio.ended & audio.src

`audio.ended`é¡¾åæ€ä¹‰ï¼Œä¼šåœ¨éŸ³é¢‘ç»“æŸåè¢«æ¿€æ´»ï¼›

`audio.src`æ˜¯éŸ³é¢‘æ–‡ä»¶çš„ä½ç½®ï¼Œå¯ä¿®æ”¹ï¼›

å½“ä½ æœ‰ä¸€ä¸ªæ’­æ”¾åˆ—è¡¨ï¼Œä¸”æƒ³åœ¨éŸ³é¢‘ç»“æŸåæ’­æ”¾ä¸‹ä¸€é¦–æ­Œï¼Œä½ å°±å¯ä»¥ï¼š

```javascript
// å®šä¹‰æ’­æ”¾åˆ—è¡¨
let playList = [
    'path/to/song1',
    'path/to/song2',
    'path/to/song3'
]

// å®šä¹‰å½“å‰æ’­æ”¾æ­Œæ›²çš„ID
let currentSongID = 0;

// éŸ³é¢‘ç»“æŸåè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦–
audio.onended = function(){
    
    // æ›´æ–°å½“å‰æ’­æ”¾æ­Œæ›²çš„ID
    currentSongID = currentSongID + 1
    
    // å¦‚æœå½“å‰æ’­æ”¾æ­Œæ›²ä¸ºæ’­æ”¾åˆ—è¡¨ä¸­æœ€åä¸€é¦–
    // å°±ä»ç¬¬ä¸€é¦–å¼€å§‹æ”¾
    if(currentSongID >= playList.length){
        currentSongID = 0
    }
    
    // æ”¹å˜audioçš„srcå±æ€§
    audio.src = playList[currentSongID]
    audio.play()
}
```

å“¦è¿˜æœ‰ï¼

#### # audio.volume

è°ƒç”¨è·å–éŸ³é¢‘çš„éŸ³é‡ï¼Œå¯ä¿®æ”¹ï¼›

å¯ä»¥åšç‚¹fade in / fade outçš„æ•ˆæœï¼Œä½¿ç”¨jQueryå¯ä»¥å¾ˆç®€å•çš„åšå‡ºæ¥ï¼ŒåŸæ–‡ä¸­ä¹Ÿæœ‰åŸç”Ÿjsçš„å®ç°æ–¹æ³•(å¤ªé•¿æ²¡çœ‹

> ```javascript
> $audio.animate({volume: newVolume}, 1000)
> ```

åŸæ–‡é“¾æ¥ï¼š[https://stackoverflow.com/questions/7451508/html5-audio-playback-with-fade-in-and-fade-out](https://stackoverflow.com/questions/7451508/html5-audio-playback-with-fade-in-and-fade-out)



å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯æˆ‘å¼€å‘éŸ³ä¹ä¸»é¡µä¹‹åæƒ³å’Œå¤§å®¶åˆ†äº«çš„ã€‚

è‡³äºé¢˜ä¸­çš„é—®é¢˜ï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯ï¼šçœŸçš„å¾ˆç®€å•ã€‚

åªæ˜¯jsæœ‰ä¸€äº›æ€§èƒ½ä¸Šçš„é™åˆ¶ï¼Œä¸èƒ½ä»€ä¹ˆåŠŸèƒ½éƒ½å¾€ç½‘é¡µä¸Šæ¬...

åœ¨æˆ‘çš„éŸ³ä¹ä¸»é¡µä¸­æœ‰ä¸€ä¸ªç æ‰çš„åŠŸèƒ½

â€”â€” èŠ‚æ‹å™¨

ä¸ºå•¥ç æ‰äº†å‘¢...

å› ä¸ºjsçš„å¤„ç†æ•ˆç‡çœŸçš„ä¸é«˜(æˆ–è€…åªæ˜¯æˆ‘å¤ªè¾£é¸¡)ï¼Œä¸­ä½ç«¯æ‰‹æœºåšå‡ºæ¥çš„èŠ‚æ‹å™¨æ ¹æœ¬ä¸å‡†ï¼Œè‡³äºå®ç°åŸç†ï¼Œå¾ˆç®€å•ï¼š

æ­Œæ›²çš„bpm(beat per minute)æ˜¯å·²çŸ¥çš„ï¼š

```javascript
// å‡è®¾ç°åœ¨æˆ‘æœ‰ä¸€é¦–æ­Œbpmä¸º120
let bpm = 120

// æ¯40æ¯«ç§’æ›´æ–°ä¸€æ¬¡ï¼Œç›®çš„æ˜¯è®©bpmæ›´æ–°ä¸ä½äº24fps
// ç„¶è€Œä¸­ä½ç«¯æ‰‹æœºçš„æ•ˆæœå´ä¸å°½äººæ„
// pcç«¯å€’æ˜¯æ²¡å•¥é—®é¢˜
let bpmTimeInterval = setInterval(function(){
    // è®¡ç®—æ¯ç§’æœ‰å¤šå°‘beats
    let interval = bpm / 60
    
    // _bä¼šåœ¨æ—¶é—´çº¿å‘ˆç°å‡ºä¸€ä¸ªé”¯é½¿çŠ¶çš„å›¾å½¢
    // æœ€é«˜é‚£ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯é½¿å°–ï¼Œå°±æ˜¯ä¸€ä¸ªbeat
    let _b = audio.currentTime % interval
    // ...
},40)
```

å¸Œæœ›æœ‰ä¸€å¤©jsèƒ½æœ‰å¼€å‘Digital Audio Workstationçš„èƒ½åŠ›ï¼

âœŒ


